# Wallet Backend

## Getting Started

Tech Used:
1. Express
2. JWT - for authentication
3. SQLite - for storing data

Project organization is service oriented, every service has controller and routes export which is abstracted and can be easly adjusted to work with other nodejs frameworks, route definition example:
```
{
  path: '/getOrders',       // URL
  method: 'GET',            // HTTP method definition
  middlewares: {            // middlewares definitions
    preRoute: [             // Middlewares that are called before handler execution
      jwt(config)
    ],
    postRoute: []           // Middlewares that will be attached after handler finish execution
  },
  handler: () => {}         // Handler e.g: controller contains business logic
}
```

Services are dependant of DB models, but this can be moved to separate modul and imported and used in handlers/services 

Routes are set in dynamic way based on exported routes from services:

```
import { Application } from 'express';
import authRoutes from './auth';
import usersRoute from './users';
import balancesRoutes from './balances';
import transactionRoutes from './transactions';
import ordersRoutes from './order';

export default (app: Application) => {
  const routes = [
    ...authRoutes,
    ...usersRoute,
    ...balancesRoutes,
    ...transactionRoutes,
    ...ordersRoutes
  ];
  
  routes.forEach(route => {
    // @ts-ignore
    app[route.method.toLowerCase()](
      route.path,
      route.middlewares ? route.middlewares.preRoute || [] : [], 
      route.handler,
      route.middlewares ? route.middlewares.postRoute || [] : []
    );
  });

  return routes;
};

```

## IMPORTANT NOTE
In order to process placed orders, cron job is created which runs every minute and updates all pending orders to `COMPLETED`, Cron job is set via `node-cron` lib so no need to run cron job manually via crontab in execution env.

Folder structure

![](https://i.imgur.com/ef357xk.png)


## Start project

1. yarn install
2. yarn start

DB will be generated by default without need to run migrations, since it is SQLlite db, DB will be created regradles if machine that runs app has installed and configured DB, all data will be saved in SQLLite file on system location.


# Things to improve if more time is available
1. Update architecture to Onion type of architecture, check example on following repo: https://github.com/StefanJovic123/service-provider-app, reason for this is to have more decoupled code and more agnostic of underlineing framework or ORM specific lib that is used.
2. Introduce service/repository pattern to deal with data and move data manipulation from current controllers/handlers
3. Remove cron job for updating orders statuses and move towards queues and messaging systems like Redis or Kafka to manage when Orders gets updated/processed in order to have more performante solution which will sustain over time.
4. Add code linters and formatters to achieve code quality from formatting point of view.